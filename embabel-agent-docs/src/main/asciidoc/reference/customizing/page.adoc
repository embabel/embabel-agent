[[reference.customizing]]
=== Customizing Embabel

==== Adding LLMs

You can add custom LLMs as Spring beans by implementing the `LlmService` interface.
Embabel provides `SpringAiLlmService` for wrapping Spring AI `ChatModel` instances.

===== Using `SpringAiLlmService`

`SpringAiLlmService` implements the `LlmService` interface and provides framework-agnostic LLM operations
including support for the Embabel tool loop and message sender abstraction.

[source,java]
----
@Configuration
public class LlmsConfig {
    @Bean
    public LlmService<?> myLlm() {
        org.springframework.ai.chat.model.ChatModel chatModel = ...
        return new SpringAiLlmService(
                "myChatModel",              // <1>
                "myChatModelProvider",      // <2>
                chatModel)                  // <3>
            .withOptionsConverter(new MyLlmOptionsConverter()) // <4>
            .withKnowledgeCutoffDate(LocalDate.of(2025, 4, 1)); // <5>
    }
}
----

<1> The name of the LLM (used for model selection).
<2> The provider name, such as "OpenAI" or "Anthropic".
<3> The Spring AI `ChatModel` instance.
<4> Customize with an `OptionsConverter` implementation to convert Embabel `LlmOptions` to Spring AI `ChatOptions`.
<5> Set the knowledge cutoff date if available.

===== LLM Configuration Options

`SpringAiLlmService` supports the following configuration:

- name (required)
- provider, such as "Mistral" (required)
- `OptionsConverter` to convert Embabel `LlmOptions` to Spring AI `ChatOptions`
- *knowledge cutoff date* (if available)
- any additional `PromptContributor` objects to be used in all LLM calls.
If knowledge cutoff date is provided, add the `KnowledgeCutoffDate` prompt contributor.
- pricing model (if available)

A common requirement is to add an OpenAI-compatible LLM.
This can be done by extending the `OpenAiCompatibleModelFactory` class as follows:

[source,kotlin]
----
@Configuration
class CustomOpenAiCompatibleModels(
    @Value("\${MY_BASE_URL:#{null}}")
    baseUrl: String?,
    @Value("\${MY_API_KEY}")
    apiKey: String,
    observationRegistry: ObservationRegistry,
) : OpenAiCompatibleModelFactory(baseUrl = baseUrl, apiKey = apiKey, observationRegistry = observationRegistry) {

    @Bean
    fun myGreatModel(): LlmService<*> {
        // Call superclass method
        return openAiCompatibleLlm(
            model = "my-great-model",
            provider = "me",
            knowledgeCutoffDate = LocalDate.of(2025, 1, 1),
            pricingModel = PerTokenPricingModel(
                usdPer1mInputTokens = .40,
                usdPer1mOutputTokens = 1.6,
            )
        )
    }
}
----

==== Adding embedding models

Embedding models can also be added as beans of the Embabel type `EmbeddingService`.
Use the `SpringAiEmbeddingService` class to wrap a Spring AI `EmbeddingModel`.

Typically, this is done in an `@Configuration` class like this:

[source,java]
----
@Configuration
public class EmbeddingModelsConfig {
    @Bean
    public EmbeddingService myEmbeddingModel() {
        org.springframework.ai.embedding.EmbeddingModel embeddingModel = ...
        return new SpringAiEmbeddingService(
                "myEmbeddingModel",
                "myEmbeddingModelProvider",
                embeddingModel);
    }
}
----

==== Configuration via `application.properties` or `application.yml`

You can specify Spring configuration, your own configuration and Embabel configuration in the regular Spring configuration files.
Profile usage will work as expected.

==== Customizing logging

You can customize logging as in any Spring application.

For example, in `application.properties` you can set properties like:

[source,properties]
----
logging.level.com.embabel.agent.a2a=DEBUG
----

You can also configure logging via a `logback-spring.xml` file if you have more sophisticated requirements.

See the https://docs.spring.io/spring-boot/reference/features/logging.html[Spring Boot Logging] reference.

By default, many Embabel examples use personality-based logging experiences such as Star Wars.
You can disable this by updating application.properties accordingly.

[source,text]
----
embabel.agent.logging.personality=severance
----

Remove the `embabel.agent.logging.personality` key to disable personality-based logging.

As all logging results from listening to events via an `AgenticEventListener`, you can also easily create your own customized logging.


